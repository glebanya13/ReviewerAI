#!/usr/bin/env python3
# -*- coding: utf-8 -*-

import re

# === –£–∫–∞–∂–∏ –ø—É—Ç—å –∫ —Ñ–∞–π–ª—É ===
INPUT_FILE = "train.csv"      # –∏—Å—Ö–æ–¥–Ω—ã–π —Ñ–∞–π–ª

def clean_text(text: str) -> str:
    # –Ω–∏–∂–Ω–∏–π —Ä–µ–≥–∏—Å—Ç—Ä
    text = text.lower()

    # —É–¥–∞–ª–∏—Ç—å html-—Ç–µ–≥–∏
    text = re.sub(r"<[^>]+>", " ", text)

    # üîπ —Å–Ω–∞—á–∞–ª–∞ —É–¥–∞–ª–∏—Ç—å –¥–∞—Ç—ã —Ü–µ–ª–∏–∫–æ–º
    # –≤–∞—Ä–∏–∞–Ω—Ç—ã: yyyy-mm-dd, dd.mm.yyyy, dd/mm/yy –∏ —Ç.–¥.
    text = re.sub(
        r"(\d{4}[-./]\d{1,2}[-./]\d{1,2})|(\d{1,2}[-./]\d{1,2}[-./]\d{2,4})",
        "",
        text,
    )

    # —É–¥–∞–ª–∏—Ç—å —Å–º–∞–π–ª–∏–∫–∏ –∏ —Å–ø–µ—Ü—Å–∏–º–≤–æ–ª—ã (–æ—Å—Ç–∞–≤–ª—è–µ–º –±—É–∫–≤—ã, —Ü–∏—Ñ—Ä—ã, –∑–Ω–∞–∫–∏ –ø—Ä–µ–ø–∏–Ω–∞–Ω–∏—è, –ø—Ä–æ–±–µ–ª—ã)
    text = re.sub(r"[^\w\s.,!?-]", " ", text, flags=re.UNICODE)

    # —Å—Ö–ª–æ–ø—ã–≤–∞–Ω–∏–µ –ø–æ–≤—Ç–æ—Ä—è—é—â–∏—Ö—Å—è —Å–∏–º–≤–æ–ª–æ–≤ (2 –∏ –±–æ–ª–µ–µ ‚Üí 1)
    text = re.sub(r"(.)\1+", r"\1", text)

    # —É–¥–∞–ª–∏—Ç—å –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ü–∏—Ñ—Ä 3+ –ø–æ–¥—Ä—è–¥
    text = re.sub(r"\d{3,}", "", text)

    # –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ–±–µ–ª–æ–≤
    text = re.sub(r"\s+", " ", text).strip()

    # –£–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö –ø—Ä–æ–±–µ–ª–æ–≤ (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ, —Ä–∞—Å–∫–æ–º–º–µ–Ω—Ç–∏—Ä—É–π ‚Üì)
    text = text.replace(" ", "")

    return text

if __name__ == "__main__":
    with open(INPUT_FILE, "r", encoding="utf-8") as fin:
        for line in fin:
            cleaned = clean_text(line)
            if cleaned:
                print(cleaned)
